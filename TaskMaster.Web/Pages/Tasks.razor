@page "/tasks"
@using TaskMaster.CLI.Models
@using Blazored.LocalStorage
@inject ILocalStorageService localStorage
@inject NavigationManager Navigation
@inject HttpClient Http

<h3>Mis Tareas</h3>

@if (tasks == null)
{
    <p><em>Cargando tareas...</em></p>
}
else
{
    <ul>
        @foreach (var task in tasks)
        {
            <li>@task.Title - @task.Status</li>
        }
    </ul>
}

@code {
    private IEnumerable<TaskItem>? tasks;

    protected override async Task OnInitializedAsync()
    {
        // Recuperar el token del almacenamiento local
        var token = await localStorage.GetItemAsync<string>("authToken");

        if (string.IsNullOrEmpty(token))
        {
            Navigation.NavigateTo("/login");
            return;
        }

        // Adjuntar el token a la cabecera de autorización
        Http.DefaultRequestHeaders.Authorization =
            new System.Net.Http.Headers.AuthenticationHeaderValue("Bearer", token);

        try
        {
            tasks = await Http.GetFromJsonAsync<IEnumerable<TaskItem>>("api/tasks");
        }
        catch { /* Manejar error */ }
    }
}